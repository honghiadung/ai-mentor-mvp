ai-mentor-mvp/
├─ server.js
├─ package.json
└─ public/
   ├─ index.html
   ├─ styles.css
   └─ app.js
{
  "name": "ai-mentor-mvp",
  "version": "1.0.0",
  "description": "MVP AI Mentor + AI Reflect + Video Checkpoint",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "dotenv": "^16.3.1",
    "node-fetch": "^3.3.2"
  },
  "type": "module"
}
import express from "express";
import fetch from "node-fetch";
import dotenv from "dotenv";
dotenv.config();

const app = express();
app.use(express.json());
app.use(express.static("public"));

const OPENAI_KEY = process.env.OPENAI_API_KEY || "";

// Rate limit demo
const bucket = {};
function allow(ip) {
  const now = Date.now();
  bucket[ip] = bucket[ip] || [];
  bucket[ip] = bucket[ip].filter(t => now - t < 60000);
  if (bucket[ip].length > 60) return false;
  bucket[ip].push(now);
  return true;
}

app.post("/chat", async (req, res) => {
  try {
    const ip = req.ip;
    if (!allow(ip)) return res.status(429).json({ error: "rate_limited" });

    const { messages, mode } = req.body;
    const systemPrompt = `
You are "AI Mentor" & "AI Reflect".
AI Mentor: Không trả lời trực tiếp, đặt câu hỏi Socratic.
AI Reflect: Phân tích từng bước, nhận xét ĐÚNG/SAI, gợi ý sửa.
Trả lời ngắn gọn (1-3 câu), dùng JSON-like khi phù hợp.
`;

    const payload = {
      model: "gpt-4o-mini",
      messages: [
        { role: "system", content: systemPrompt },
        ...messages
      ],
      max_tokens: 400,
      temperature: 0.6
    };

    if (!OPENAI_KEY) {
      // fallback offline
      const last = messages[messages.length-1]?.content || "";
      if (last.trim().endsWith("?") || /vì sao|tại sao/i.test(last)) {
        return res.json({ reply: "AI Mentor: Theo em, phần chính của câu hỏi này liên quan đến khái niệm nào? Liệt kê những gì em biết trước." });
      } else {
        return res.json({ reply: "AI Mentor offline: Chưa có API key. Nêu bước bạn đã làm để AI phản hồi." });
      }
    }

    const r = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: { "Authorization": `Bearer ${OPENAI_KEY}`, "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const data = await r.json();
    const text = data?.choices?.[0]?.message?.content || JSON.stringify(data);
    res.json({ reply: text });

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message || "server_error" });
  }
});

const port = process.env.PORT || 3000;
app.listen(port, () => console.log("Server running on port", port));
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Mentor MVP</title>
  <link href="styles.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <header>
      <h1>AI Mentor & AI Reflect</h1>
      <select id="mode">
        <option value="mentor">AI Mentor (Socratic)</option>
        <option value="reflect">AI Reflect</option>
      </select>
      <button id="clear">Clear Chat</button>
    </header>

    <main id="chat"></main>

    <footer>
      <textarea id="input" placeholder="Nhập câu hỏi hoặc lời giải..." rows="2"></textarea>
      <button id="send">Gửi</button>
      <div id="timer">Time: 00:00</div>
    </footer>

    <section class="video">
      <h3>Bài giảng</h3>
      <iframe id="ytplayer" width="560" height="315" src="https://www.youtube.com/embed/VIDEO_ID?enablejsapi=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      <div class="checkpoint">
        <button id="openQuiz">Mở quiz</button>
        <small>Sai 3 lần → tự tua lại đoạn trước.</small>
      </div>
    </section>
  </div>
  <script src="app.js"></script>
</body>
</html>
:root{--bg:#f6f8fb;--card:#fff;--accent:#0b5cff}
body{font-family:Inter,Arial,sans-serif;background:var(--bg);margin:0}
.container{max-width:900px;margin:18px auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center}
#chat{min-height:300px;background:var(--card);padding:12px;border-radius:8px;overflow:auto;margin:12px 0}
.msg{margin:8px 0;padding:10px;border-radius:8px;max-width:80%}
.msg.user{background:#e6f4ff;margin-left:auto}
.msg.bot{background:#f1f1f1}
footer{display:flex;gap:8px;align-items:center}
textarea{flex:1;padding:8px;border-radius:6px;border:1px solid #ddd}
button{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
.video{margin-top:14px;background:var(--card);padding:12px;border-radius:8px}
const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("input");
const sendBtn = document.getElementById("send");
const clearBtn = document.getElementById("clear");
const modeEl = document.getElementById("mode");
const timerEl = document.getElementById("timer");
const openQuiz = document.getElementById("openQuiz");

let messages = [];
let startTime = Date.now();
let mistakeCount = 0;

function append(role,text){
  const d=document.createElement("div");
  d.className="msg "+(role==="user"?"user":"bot");
  d.innerText=text;
  chatEl.appendChild(d);
  chatEl.scrollTop=chatEl.scrollHeight;
}

async function send(){
  const txt=inputEl.value.trim();
  if(!txt) return;
  append("user",txt);
  messages.push({role:"user",content:txt});
  inputEl.value="";
  append("bot","Đang xử lý...");
  try{
    const res=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages,mode:modeEl.value})});
    const j=await res.json();
    const last=chatEl.querySelectorAll(".msg.bot");
    if(last.length) last[last.length-1].remove();
    const reply=j.reply||JSON.stringify(j);
    append("bot",reply);
    messages.push({role:"assistant",content:reply});
    if(/sai|không đúng|wrong/i.test(reply)) mistakeCount++; else mistakeCount=0;
    if(mistakeCount>=3){
      alert("Sai 3 lần — hệ thống tua lại đoạn trước.");
      append("bot","[System] Suggestion: Review previous video section.");
      mistakeCount=0;
    }
  }catch(err){append("bot","Lỗi: "+err.message);}
}

// Timer
setInterval(()=>{
  const elapsed=Math.floor((Date.now()-startTime)/1000);
  const mm=String(Math.floor(elapsed/60)).padStart(2,"0");
  const ss=String(elapsed%60).padStart(2,"0");
  timerEl.innerText=`Time: ${mm}:${ss}`;
  if(elapsed>2700&&!document.getElementById("breakAlert")){
    const b=document.createElement("div");
    b.id="breakAlert";
    b.innerText="Học >45 phút. Nghỉ 5 phút để tránh mỏi não.";
    b.style.background="#fff3cd";b.style.padding="8px";b.style.borderRadius="6px";b.style.marginTop="8px";
    document.querySelector(".container").appendChild(b);
  }
},1000);

sendBtn.onclick=send;
inputEl.addEventListener("keydown",(e)=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();send();}});
clearBtn.onclick=()=>{messages=[];chatEl.innerHTML="";startTime=Date.now();};
openQuiz.onclick=()=>{window.open("https://forms.gle/YOUR_GOOGLE_FORM_LINK","_blank");};
